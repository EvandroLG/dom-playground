<!doctype html>
<html>
  <head>
    <title>Tabs</title>
    <style>
      .off {
        display: none;
      }
    </style>
  </head>
  <body>
    <tab-panel>
      <div data-tabname="one">
        Tab one
      </div>
      <div data-tabname="two">
        Tab two
      </div>
      <div data-tabname="three">
        Tab three
      </div>
    </tab-panel>

    <script>
      function delegate(eventType, container, matches, callback) {
        container.addEventListener(eventType, (e) => {
          const { target } = e;

          if (target.matches(matches)) {
            callback.call(target, e);
          }
        }, false);
      }

      function Tabs(root) {
        const elements = {};
        elements.contents = Array.from(root.querySelectorAll('*[data-tabname]'));

        function showTab(tabName) {
          if (!tabName) {
            return;
          }

          for (const content of elements.contents) {
            debugger;
            if (content.dataset.tabname === tabName) {
              content.classList.remove('off');
            } else {
              content.classList.add('off');
            }
          }
        }

        function onClick({ target }) {
          const tabName = target.dataset.tabname;
          history.pushState(null, null, `#${tabName}`);

          showTab(tabName);
        }

        return {
          destroy() {},

          render() {
            elements.fragment = document.createDocumentFragment();
            elements.button = document.createElement('button');

            for (let i = 0; i < elements.contents.length; i++) {
              const content = elements.contents[i];

              if (i > 0) {
                content.classList.add('off');
              }

              const button = elements.button.cloneNode(false);
              const tabName = content.dataset.tabname;

              button.dataset.tabname = tabName;
              button.textContent = tabName;
              elements.fragment.appendChild(button);
            }

            showTab(location.hash.slice(1));

            window.addEventListener('popstate', () => {
              showTab(location.hash.slice(1));
            });

            delegate('click', root, 'button[data-tabname]', onClick);

            root.prepend(elements.fragment);
          },
        };
      }

      function onReady() {
        new Tabs(
          document.querySelector('tab-panel')
        ).render();
      }

      document.addEventListener('DOMContentLoaded', onReady, false);
    </script>
  </body>
</html>
