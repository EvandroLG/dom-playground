<!doctype html>
<html>
  <head>
    <title>Timing Element Visibility</title>
    <style>
      .wrapper {
        width: 800px;
        margin: 0 auto;
      }
    </style>
  </head>
  <body>
    <div class="wrapper">
      <header>
        <h1>A Fake Page</h1>
      </header>

      <main>
        <article id="article-1">
          <h2>Article 1</h2>
          <p>
            Lorem ipsum dolor sit amet, consectetur adipiscing elit. Cras at sem diam. Vestibulum venenatis massa in tincidunt egestas. Morbi eu lorem vel est sodales auctor hendrerit placerat risus. Etiam rutrum faucibus sem, vitae mattis ipsum ullamcorper eu. Donec nec imperdiet nibh, nec vehicula libero. Phasellus vel malesuada nulla. Aliquam sed magna aliquam, vestibulum nisi at, cursus nunc.
          </p>
          <p>
            Lorem ipsum dolor sit amet, consectetur adipiscing elit. Cras at sem diam. Vestibulum venenatis massa in tincidunt egestas. Morbi eu lorem vel est sodales auctor hendrerit placerat risus. Etiam rutrum faucibus sem, vitae mattis ipsum ullamcorper eu. Donec nec imperdiet nibh, nec vehicula libero. Phasellus vel malesuada nulla. Aliquam sed magna aliquam, vestibulum nisi at, cursus nunc.
          </p>
          <p>
            Lorem ipsum dolor sit amet, consectetur adipiscing elit. Cras at sem diam. Vestibulum venenatis massa in tincidunt egestas. Morbi eu lorem vel est sodales auctor hendrerit placerat risus. Etiam rutrum faucibus sem, vitae mattis ipsum ullamcorper eu. Donec nec imperdiet nibh, nec vehicula libero. Phasellus vel malesuada nulla. Aliquam sed magna aliquam, vestibulum nisi at, cursus nunc.
          </p>
          <p>
            Lorem ipsum dolor sit amet, consectetur adipiscing elit. Cras at sem diam. Vestibulum venenatis massa in tincidunt egestas. Morbi eu lorem vel est sodales auctor hendrerit placerat risus. Etiam rutrum faucibus sem, vitae mattis ipsum ullamcorper eu. Donec nec imperdiet nibh, nec vehicula libero. Phasellus vel malesuada nulla. Aliquam sed magna aliquam, vestibulum nisi at, cursus nunc.
          </p>
        </article>

        <article id="article-2">
          <h2>Article 2</h2>
          <p>
            Lorem ipsum dolor sit amet, consectetur adipiscing elit. Cras at sem diam. Vestibulum venenatis massa in tincidunt egestas. Morbi eu lorem vel est sodales auctor hendrerit placerat risus. Etiam rutrum faucibus sem, vitae mattis ipsum ullamcorper eu. Donec nec imperdiet nibh, nec vehicula libero. Phasellus vel malesuada nulla. Aliquam sed magna aliquam, vestibulum nisi at, cursus nunc.
          </p>
          <p>
            Lorem ipsum dolor sit amet, consectetur adipiscing elit. Cras at sem diam. Vestibulum venenatis massa in tincidunt egestas. Morbi eu lorem vel est sodales auctor hendrerit placerat risus. Etiam rutrum faucibus sem, vitae mattis ipsum ullamcorper eu. Donec nec imperdiet nibh, nec vehicula libero. Phasellus vel malesuada nulla. Aliquam sed magna aliquam, vestibulum nisi at, cursus nunc.
          </p>
          <p>
            Lorem ipsum dolor sit amet, consectetur adipiscing elit. Cras at sem diam. Vestibulum venenatis massa in tincidunt egestas. Morbi eu lorem vel est sodales auctor hendrerit placerat risus. Etiam rutrum faucibus sem, vitae mattis ipsum ullamcorper eu. Donec nec imperdiet nibh, nec vehicula libero. Phasellus vel malesuada nulla. Aliquam sed magna aliquam, vestibulum nisi at, cursus nunc.
          </p>
          <p>
            Lorem ipsum dolor sit amet, consectetur adipiscing elit. Cras at sem diam. Vestibulum venenatis massa in tincidunt egestas. Morbi eu lorem vel est sodales auctor hendrerit placerat risus. Etiam rutrum faucibus sem, vitae mattis ipsum ullamcorper eu. Donec nec imperdiet nibh, nec vehicula libero. Phasellus vel malesuada nulla. Aliquam sed magna aliquam, vestibulum nisi at, cursus nunc.
          </p>
        </article>

        <article id="article-3">
          <h2>Article 3</h2>
          <p>
            Lorem ipsum dolor sit amet, consectetur adipiscing elit. Cras at sem diam. Vestibulum venenatis massa in tincidunt egestas. Morbi eu lorem vel est sodales auctor hendrerit placerat risus. Etiam rutrum faucibus sem, vitae mattis ipsum ullamcorper eu. Donec nec imperdiet nibh, nec vehicula libero. Phasellus vel malesuada nulla. Aliquam sed magna aliquam, vestibulum nisi at, cursus nunc.
          </p>
          <p>
            Lorem ipsum dolor sit amet, consectetur adipiscing elit. Cras at sem diam. Vestibulum venenatis massa in tincidunt egestas. Morbi eu lorem vel est sodales auctor hendrerit placerat risus. Etiam rutrum faucibus sem, vitae mattis ipsum ullamcorper eu. Donec nec imperdiet nibh, nec vehicula libero. Phasellus vel malesuada nulla. Aliquam sed magna aliquam, vestibulum nisi at, cursus nunc.
          </p>
          <p>
            Lorem ipsum dolor sit amet, consectetur adipiscing elit. Cras at sem diam. Vestibulum venenatis massa in tincidunt egestas. Morbi eu lorem vel est sodales auctor hendrerit placerat risus. Etiam rutrum faucibus sem, vitae mattis ipsum ullamcorper eu. Donec nec imperdiet nibh, nec vehicula libero. Phasellus vel malesuada nulla. Aliquam sed magna aliquam, vestibulum nisi at, cursus nunc.
          </p>
          <p>
            Lorem ipsum dolor sit amet, consectetur adipiscing elit. Cras at sem diam. Vestibulum venenatis massa in tincidunt egestas. Morbi eu lorem vel est sodales auctor hendrerit placerat risus. Etiam rutrum faucibus sem, vitae mattis ipsum ullamcorper eu. Donec nec imperdiet nibh, nec vehicula libero. Phasellus vel malesuada nulla. Aliquam sed magna aliquam, vestibulum nisi at, cursus nunc.
          </p>
        </article>

        <article id="article-4">
          <h2>Article 4</h2>
          <p>
            Lorem ipsum dolor sit amet, consectetur adipiscing elit. Cras at sem diam. Vestibulum venenatis massa in tincidunt egestas. Morbi eu lorem vel est sodales auctor hendrerit placerat risus. Etiam rutrum faucibus sem, vitae mattis ipsum ullamcorper eu. Donec nec imperdiet nibh, nec vehicula libero. Phasellus vel malesuada nulla. Aliquam sed magna aliquam, vestibulum nisi at, cursus nunc.
          </p>
          <p>
            Lorem ipsum dolor sit amet, consectetur adipiscing elit. Cras at sem diam. Vestibulum venenatis massa in tincidunt egestas. Morbi eu lorem vel est sodales auctor hendrerit placerat risus. Etiam rutrum faucibus sem, vitae mattis ipsum ullamcorper eu. Donec nec imperdiet nibh, nec vehicula libero. Phasellus vel malesuada nulla. Aliquam sed magna aliquam, vestibulum nisi at, cursus nunc.
          </p>
          <p>
            Lorem ipsum dolor sit amet, consectetur adipiscing elit. Cras at sem diam. Vestibulum venenatis massa in tincidunt egestas. Morbi eu lorem vel est sodales auctor hendrerit placerat risus. Etiam rutrum faucibus sem, vitae mattis ipsum ullamcorper eu. Donec nec imperdiet nibh, nec vehicula libero. Phasellus vel malesuada nulla. Aliquam sed magna aliquam, vestibulum nisi at, cursus nunc.
          </p>
          <p>
            Lorem ipsum dolor sit amet, consectetur adipiscing elit. Cras at sem diam. Vestibulum venenatis massa in tincidunt egestas. Morbi eu lorem vel est sodales auctor hendrerit placerat risus. Etiam rutrum faucibus sem, vitae mattis ipsum ullamcorper eu. Donec nec imperdiet nibh, nec vehicula libero. Phasellus vel malesuada nulla. Aliquam sed magna aliquam, vestibulum nisi at, cursus nunc.
          </p>
        </article>

        <article id="article-5">
          <h2>Article 5</h2>
          <p>
            Lorem ipsum dolor sit amet, consectetur adipiscing elit. Cras at sem diam. Vestibulum venenatis massa in tincidunt egestas. Morbi eu lorem vel est sodales auctor hendrerit placerat risus. Etiam rutrum faucibus sem, vitae mattis ipsum ullamcorper eu. Donec nec imperdiet nibh, nec vehicula libero. Phasellus vel malesuada nulla. Aliquam sed magna aliquam, vestibulum nisi at, cursus nunc.
          </p>
          <p>
            Lorem ipsum dolor sit amet, consectetur adipiscing elit. Cras at sem diam. Vestibulum venenatis massa in tincidunt egestas. Morbi eu lorem vel est sodales auctor hendrerit placerat risus. Etiam rutrum faucibus sem, vitae mattis ipsum ullamcorper eu. Donec nec imperdiet nibh, nec vehicula libero. Phasellus vel malesuada nulla. Aliquam sed magna aliquam, vestibulum nisi at, cursus nunc.
          </p>
          <p>
            Lorem ipsum dolor sit amet, consectetur adipiscing elit. Cras at sem diam. Vestibulum venenatis massa in tincidunt egestas. Morbi eu lorem vel est sodales auctor hendrerit placerat risus. Etiam rutrum faucibus sem, vitae mattis ipsum ullamcorper eu. Donec nec imperdiet nibh, nec vehicula libero. Phasellus vel malesuada nulla. Aliquam sed magna aliquam, vestibulum nisi at, cursus nunc.
          </p>
          <p>
            Lorem ipsum dolor sit amet, consectetur adipiscing elit. Cras at sem diam. Vestibulum venenatis massa in tincidunt egestas. Morbi eu lorem vel est sodales auctor hendrerit placerat risus. Etiam rutrum faucibus sem, vitae mattis ipsum ullamcorper eu. Donec nec imperdiet nibh, nec vehicula libero. Phasellus vel malesuada nulla. Aliquam sed magna aliquam, vestibulum nisi at, cursus nunc.
          </p>
        </article>

        <article id="article-6">
          <h2>Article 6</h2>
          <p>
            Lorem ipsum dolor sit amet, consectetur adipiscing elit. Cras at sem diam. Vestibulum venenatis massa in tincidunt egestas. Morbi eu lorem vel est sodales auctor hendrerit placerat risus. Etiam rutrum faucibus sem, vitae mattis ipsum ullamcorper eu. Donec nec imperdiet nibh, nec vehicula libero. Phasellus vel malesuada nulla. Aliquam sed magna aliquam, vestibulum nisi at, cursus nunc.
          </p>
          <p>
            Lorem ipsum dolor sit amet, consectetur adipiscing elit. Cras at sem diam. Vestibulum venenatis massa in tincidunt egestas. Morbi eu lorem vel est sodales auctor hendrerit placerat risus. Etiam rutrum faucibus sem, vitae mattis ipsum ullamcorper eu. Donec nec imperdiet nibh, nec vehicula libero. Phasellus vel malesuada nulla. Aliquam sed magna aliquam, vestibulum nisi at, cursus nunc.
          </p>
          <p>
            Lorem ipsum dolor sit amet, consectetur adipiscing elit. Cras at sem diam. Vestibulum venenatis massa in tincidunt egestas. Morbi eu lorem vel est sodales auctor hendrerit placerat risus. Etiam rutrum faucibus sem, vitae mattis ipsum ullamcorper eu. Donec nec imperdiet nibh, nec vehicula libero. Phasellus vel malesuada nulla. Aliquam sed magna aliquam, vestibulum nisi at, cursus nunc.
          </p>
          <p>
            Lorem ipsum dolor sit amet, consectetur adipiscing elit. Cras at sem diam. Vestibulum venenatis massa in tincidunt egestas. Morbi eu lorem vel est sodales auctor hendrerit placerat risus. Etiam rutrum faucibus sem, vitae mattis ipsum ullamcorper eu. Donec nec imperdiet nibh, nec vehicula libero. Phasellus vel malesuada nulla. Aliquam sed magna aliquam, vestibulum nisi at, cursus nunc.
          </p>
        </article>
      </main>
    </div>

    <script>
      function Timer() {
        const elements = {};
        elements.timer = document.createElement('div');
        elements.hours = document.createElement('span');
        elements.minutes = document.createElement('span');
        elements.seconds = document.createElement('span');

        let seconds = 0;
        let minutes = 0;
        let hours = 0;
        let animationId = null;

        function convertTime(value) {
          return (value + '').padStart(2, '0');
        }

        function updateTime() {
          let start = performance.now();

          function animate(timestamp) {
            const elapsed = timestamp - start;

            if (elapsed >= 1000) {
              start = performance.now();

              if (seconds < 59) {
                seconds = seconds + 1;
                elements.seconds.textContent = convertTime(seconds);
              } else if (minutes < 59) {
                minutes = minutes + 1;
                elements.minutes.textContent = convertTime(minutes) + ':';
                elements.seconds.textContent = '00';
                seconds = 0;
              } else {
                hours = hours + 1;
                elements.hours.textContent = convertTime(hours) + ':';
                elements.minutes.textContent = '00';
                elements.seconds.textContent = '00';
                minutes = 0;
                seconds = 0;
              }
            }

            animationId = requestAnimationFrame(animate);
          };

          animationId = requestAnimationFrame(animate);
        }

        return {
          startTimer() {
            const io = new IntersectionObserver((entries) => {
              if (entries.some(entry => entry.intersectionRatio > 0)) {
                updateTime();
                return;
              }

              cancelAnimationFrame(animationId);
            });

            io.observe(elements.timer);
          },

          build() {
            elements.hours.textContent = '00:';
            elements.minutes.textContent = '00:';
            elements.seconds.textContent = '00';

            elements.timer.appendChild(elements.hours);
            elements.timer.appendChild(elements.minutes);
            elements.timer.appendChild(elements.seconds);

            this.startTimer();

            return elements.timer;
          }
        };
      }

      function onReady() {
        const elements = {};
        elements.firstTitle = document.querySelector('#article-1 h2');
        elements.lastTitle = document.querySelector('#article-6 h2');

        elements.firstTitle.insertAdjacentElement('afterend', Timer().build());
        elements.lastTitle.insertAdjacentElement('afterend', Timer().build());
      }

      document.addEventListener('DOMContentLoaded', onReady, false);
    </script>
  </body>
</html>
